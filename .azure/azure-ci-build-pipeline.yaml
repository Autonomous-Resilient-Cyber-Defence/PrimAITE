trigger:
- main
- dev
- feature/*
- hotfix/*
- bugfix/*
- release/*

pool:
  vmImage: ubuntu-latest
strategy:
  matrix:
    Python38:
      python.version: '3.8'
    Python39:
      python.version: '3.9'
    Python310:
      python.version: '3.10'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
  displayName: 'Use Python $(python.version)'

- script: |
    python -m pip install pre-commit
    pre-commit install
    pre-commit run --all-files
  displayName: 'Run pre-commits'

- script: |
    python -m pip install --upgrade pip==23.0.1
    pip install wheel==0.38.4 --upgrade
    pip install setuptools==66 --upgrade
    pip install build==0.10.0
    pip install pytest-azurepipelines
  displayName: 'Install build dependencies'

- script: |
    python -m build
  displayName: 'Build PrimAITE'

- script: |
    PRIMAITE_WHEEL=$(ls ./dist/primaite*.whl)
    python -m pip install $PRIMAITE_WHEEL[dev]
  displayName: 'Install PrimAITE'

- script: |
    primaite setup
  displayName: 'Perform PrimAITE Setup'

#- script: |
#    flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
#    flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
#  displayName: 'Lint with flake8'

- script: |
    pytest tests/
  displayName: 'Run tests'
